<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìŠ¤í„°ë”” ëª¨ì§‘ ê²Œì‹œíŒ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
        th { background-color: #f0f0f0; }
        .search { margin-bottom: 20px; }
        .search input { padding: 8px; }
        .search button { padding: 8px 12px; }
    </style>
</head>
<body>
<h2>ğŸ“š ìŠ¤í„°ë”” ëª¨ì§‘ ê²Œì‹œíŒ</h2>

<div class="search">
    <input type="text" id="searchTitle" placeholder="ì œëª© ê²€ìƒ‰">
    <input type="text" id="searchWriter" placeholder="ì‘ì„±ì ê²€ìƒ‰">
    <button onclick="searchStudies()">ê²€ìƒ‰</button>
</div>

<table>
    <thead>
    <tr>
        <th>ìŠ¤í„°ë”” ì œëª©</th>
        <th>ì„¤ëª…</th>
        <th>ì •ì›</th>
        <th>í˜„ì¬ ì¸ì›</th>
        <th>ë§ˆê°ì¼</th>
        <th>ì°¸ì—¬</th>
    </tr>
    </thead>
    <tbody id="studyTableBody">
    <!-- ëª©ë¡ ë™ì  ì‚½ì… -->
    </tbody>
</table>

<script>
    async function fetchStudies() {
        const res = await fetch('/studies');
        const data = await res.json();
        renderStudies(data.result.content || []);
    }

    function renderStudies(studies) {
        const tbody = document.getElementById('studyTableBody');
        tbody.innerHTML = '';
        studies.forEach(s => {
            const row = `
          <tr>
            <td>${s.title}</td>
            <td>${s.description}</td>
            <td>${s.capacity}</td>
            <td>${s.currentMembers}</td>
            <td>${s.deadline}</td>
            <td><button onclick="joinStudy(${s.studyRoomId})">ì°¸ê°€</button></td>
          </tr>
        `;
            tbody.insertAdjacentHTML('beforeend', row);
        });
    }

    async function searchStudies() {
        const title = document.getElementById('searchTitle').value;
        const writer = document.getElementById('searchWriter').value;
        const res = await fetch(`/studies/search?title=${encodeURIComponent(title)}&writer=${encodeURIComponent(writer)}`);
        const data = await res.json();
        renderStudies(data.result);
    }

    async function joinStudy(studyRoomId) {
        const token = localStorage.getItem("token");
        const res = await fetch(`/studies/${studyRoomId}/join`, {
            method: 'POST',
            headers: {
                "Authorization": `Bearer ${token}`
            }
        });
        const result = await res.json();
        alert(result.message || (res.ok ? "ì°¸ê°€ ì™„ë£Œ!" : "ì°¸ê°€ ì‹¤íŒ¨"));
    }

    fetchStudies();
</script>
</body>
</html>
